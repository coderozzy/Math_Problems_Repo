<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigma-algebra Generator - Construction from Generators</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .math { font-family: "Times New Roman", Times, serif; font-style: italic; }
        .math-b { font-family: "Times New Roman", Times, serif; font-weight: bold; font-style: normal; }
        .set-card { transition: all 0.2s ease; }
        .set-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        
        @keyframes pulse-indigo {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .generating { animation: pulse-indigo 1.5s infinite; }
    </style>
</head>
<body class="bg-white text-slate-900 min-h-screen font-sans">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <header class="mb-8 border-b pb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Sigma-algebra Generator &sigma;(G)</h1>
                <p class="text-slate-500 mt-1 italic">Closure of family G under Kolmogorov axioms</p>
            </div>
            <div class="flex items-center gap-4">
                <label class="text-sm font-bold text-slate-400 uppercase">Sample Space Size &Omega; (n):</label>
                <input type="number" id="omega-n" value="6" min="1" max="10" 
                       class="w-20 px-3 py-2 border-2 border-slate-200 rounded-xl focus:border-indigo-500 outline-none font-bold"
                       onchange="initOmega()">
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- LEFT PANEL: GENERATING FAMILY -->
            <div class="lg:col-span-4 space-y-6">
                <section class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-slate-800">
                        Primary Sets (G)
                    </h2>
                    <p class="text-xs text-slate-500 mb-6">
                        Define any subsets of &Omega;. The &sigma;-algebra will be constructed by taking all possible complements, unions, and intersections of these sets.
                    </p>

                    <div id="subset-builder" class="space-y-4">
                        <div id="element-toggles" class="flex flex-wrap gap-2 mb-4">
                            <!-- Buttons generated by JS -->
                        </div>
                        <button onclick="addGenerator()" class="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-all shadow-md active:scale-95">
                            Add set to G
                        </button>
                    </div>

                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest">Your Family G:</h3>
                            <button onclick="clearGenerators()" class="text-[10px] text-red-500 hover:underline uppercase font-bold">Clear G</button>
                        </div>
                        <div id="generator-list" class="space-y-2">
                            <!-- List of added generators -->
                        </div>
                    </div>
                </section>

                <section class="p-6 bg-white border border-slate-200 rounded-2xl">
                    <h3 class="font-bold text-slate-800 mb-4 text-sm">Completeness Analysis</h3>
                    <div id="completeness-stats" class="space-y-4">
                        <div class="text-sm text-slate-400 italic">Waiting for construction...</div>
                    </div>
                </section>
            </div>

            <!-- RIGHT PANEL: RESULTING SIGMA-ALGEBRA -->
            <div class="lg:col-span-8 space-y-6">
                <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">Resulting Sigma-algebra (F)</h2>
                            <p class="text-xs text-slate-500 font-mono mt-1" id="f-size-info">Elements count |F| = 0</p>
                        </div>
                        <button onclick="generateSigma()" class="px-8 py-3 bg-slate-900 hover:bg-black text-white font-bold rounded-xl transition-all shadow-lg active:scale-95">
                            Construct F
                        </button>
                    </div>

                    <div id="sigma-display" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <!-- F elements -->
                    </div>

                    <!-- MISSING ELEMENTS SECTION -->
                    <div id="missing-section" class="mt-12 pt-8 border-t border-slate-200 hidden">
                        <h3 class="text-sm font-bold text-red-600 uppercase mb-4 flex items-center gap-2">
                            Elements of P(&Omega;) NOT in F:
                        </h3>
                        <p class="text-xs text-slate-500 mb-4">
                            The following events are "unreachable" using your generators. This means your structure is too "coarse" to distinguish these outcomes.
                        </p>
                        <div id="missing-display" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                            <!-- Missing sets -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let n = 6;
        let generators = []; 
        let currentSelection = new Set();
        let atoms = [];
        let sigmaAlgebra = [];

        function initOmega() {
            const input = document.getElementById('omega-n');
            n = parseInt(input.value);
            generators = [];
            currentSelection.clear();
            renderToggles();
            renderGenerators();
            clearOutputs();
        }

        function clearOutputs() {
            document.getElementById('sigma-display').innerHTML = '';
            document.getElementById('missing-display').innerHTML = '';
            document.getElementById('missing-section').classList.add('hidden');
            document.getElementById('f-size-info').textContent = 'Waiting for construction...';
            document.getElementById('completeness-stats').innerHTML = '<div class="text-sm text-slate-400 italic">Waiting for construction...</div>';
        }

        function renderToggles() {
            const container = document.getElementById('element-toggles');
            container.innerHTML = '';
            for (let i = 1; i <= n; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = `w-10 h-10 rounded-lg font-bold border-2 transition-all 
                    ${currentSelection.has(i) ? 'bg-indigo-600 border-indigo-700 text-white' : 'bg-white border-slate-200 text-slate-600 hover:border-indigo-300'}`;
                
                btn.onclick = () => {
                    if (currentSelection.has(i)) currentSelection.delete(i);
                    else currentSelection.add(i);
                    renderToggles();
                };
                container.appendChild(btn);
            }
        }

        function addGenerator() {
            if (currentSelection.size === 0) return;
            const newGen = Array.from(currentSelection).sort((a,b) => a-b);
            generators.push(newGen);
            currentSelection.clear();
            renderToggles();
            renderGenerators();
            clearOutputs();
        }

        function removeGenerator(index) {
            generators.splice(index, 1);
            renderGenerators();
            clearOutputs();
        }

        function clearGenerators() {
            generators = [];
            currentSelection.clear();
            renderGenerators();
            clearOutputs();
        }

        function renderGenerators() {
            const container = document.getElementById('generator-list');
            container.innerHTML = '';
            if (generators.length === 0) {
                container.innerHTML = '<p class="text-[10px] text-slate-400 italic">No sets defined.</p>';
                return;
            }
            generators.forEach((g, idx) => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-3 bg-white rounded-xl border border-slate-100 text-sm shadow-sm";
                div.innerHTML = `
                    <span class="font-serif italic font-bold text-slate-700">G<sub>${idx+1}</sub> = { ${g.join(', ')} }</span>
                    <button onclick="removeGenerator(${idx})" class="text-slate-300 hover:text-red-500 px-2 font-bold">&times;</button>
                `;
                container.appendChild(div);
            });
        }

        function calculateAtoms() {
            const atomMap = new Map();
            for (let i = 1; i <= n; i++) {
                let signature = "";
                generators.forEach(g => {
                    signature += g.includes(i) ? "1" : "0";
                });
                if (!atomMap.has(signature)) atomMap.set(signature, []);
                atomMap.get(signature).push(i);
            }
            return Array.from(atomMap.values()).sort((a,b) => a[0] - b[0]);
        }

        function generateSigma() {
            const display = document.getElementById('sigma-display');
            display.innerHTML = '<div class="col-span-full py-12 text-center text-indigo-500 font-bold generating">Performing closure operations...</div>';

            setTimeout(() => {
                const localAtoms = calculateAtoms();
                const k = localAtoms.length;
                const totalF = Math.pow(2, k);
                const totalP = Math.pow(2, n);
                
                sigmaAlgebra = [];
                const sigmaKeys = new Set();

                for (let i = 0; i < totalF; i++) {
                    let currentSet = [];
                    for (let bit = 0; bit < k; bit++) {
                        if ((i >> bit) & 1) currentSet = currentSet.concat(localAtoms[bit]);
                    }
                    currentSet.sort((a,b) => a-b);
                    sigmaAlgebra.push(currentSet);
                    sigmaKeys.add(JSON.stringify(currentSet));
                }

                sigmaAlgebra.sort((a,b) => a.length - b.length || a[0] - b[0]);
                renderSigma();
                
                // Analysis of differences
                const missing = [];
                if (totalF < totalP) {
                    // Check singletons as simplest examples of missing elements
                    for (let i = 1; i <= n; i++) {
                        const set = [i];
                        if (!sigmaKeys.has(JSON.stringify(set))) missing.push(set);
                    }
                }

                updateStats(totalF, totalP);
                renderMissing(missing);
            }, 300);
        }

        function updateStats(sizeF, sizeP) {
            const container = document.getElementById('completeness-stats');
            const ratio = ((sizeF / sizeP) * 100).toFixed(1);
            const isFull = sizeF === sizeP;

            container.innerHTML = `
                <div class="flex justify-between items-end mb-2">
                    <span class="text-xs font-bold text-slate-500 uppercase">P(&Omega;) Coverage</span>
                    <span class="text-lg font-serif font-bold ${isFull ? 'text-emerald-600' : 'text-indigo-600'}">${ratio}%</span>
                </div>
                <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden border border-slate-200">
                    <div class="h-full ${isFull ? 'bg-emerald-500' : 'bg-indigo-500'} transition-all duration-700" style="width: ${ratio}%"></div>
                </div>
                <div class="flex justify-between text-[10px] font-mono mt-2 text-slate-400">
                    <span>|F| = ${sizeF}</span>
                    <span>|P(&Omega;)| = ${sizeP}</span>
                </div>
            `;
            document.getElementById('f-size-info').textContent = `Elements count |F| = ${sizeF}`;
        }

        function renderSigma() {
            const container = document.getElementById('sigma-display');
            container.innerHTML = '';
            sigmaAlgebra.forEach((set, idx) => {
                const div = document.createElement('div');
                div.className = "set-card p-4 bg-white border border-slate-200 rounded-xl text-xs font-mono shadow-sm flex flex-col justify-center min-h-[60px]";
                let content = set.length === 0 ? "∅" : `{ ${set.join(', ')} }`;
                if (set.length === n) content = "Ω";
                div.innerHTML = `<span class="text-[9px] text-slate-400 mb-1 uppercase">Element ${idx+1}</span><span class="font-bold text-slate-800">${content}</span>`;
                container.appendChild(div);
            });
        }

        function renderMissing(missing) {
            const section = document.getElementById('missing-section');
            const container = document.getElementById('missing-display');
            container.innerHTML = '';

            if (missing.length === 0) {
                section.classList.add('hidden');
                return;
            }

            section.classList.remove('hidden');
            missing.forEach(set => {
                const div = document.createElement('div');
                div.className = "p-3 bg-red-50 border border-red-100 rounded-lg text-[10px] font-mono text-red-400 flex items-center justify-center text-center";
                div.textContent = `{ ${set.join(', ')} }`;
                container.appendChild(div);
            });
            
            if (missing.length >= 12) {
                const more = document.createElement('div');
                more.className = "col-span-full text-center text-[10px] text-slate-400 italic mt-2";
                more.textContent = "...and other subset combinations.";
                container.appendChild(more);
            }
        }

        initOmega();
    </script>
</body>
</html>